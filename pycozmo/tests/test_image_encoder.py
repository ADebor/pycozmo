
import unittest

from pycozmo.image_encoder import ImageEncoder, str_to_image, ImageDecoder, image_to_str
from pycozmo.util import hex_dump, hex_load


class TestImageEncoder(unittest.TestCase):

    @staticmethod
    def _encode(sim: str) -> str:
        im = str_to_image(sim)
        encoder = ImageEncoder(im)
        buf = encoder.encode()
        res = hex_dump(buf)
        return res

    def assertSameImage(self, sim: str, seq: str) -> None:
        buffer = hex_load(seq)
        decoder = ImageDecoder(buffer)
        decoder.decode()
        actual = image_to_str(decoder.image)
        # self.assertEqual(sim.strip(), actual.strip())

    def test_blank(self):
        sim = """
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
"""
        expected = "3f:3f"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_fill_screen(self):
        sim = """
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
"""
        expected = "fd:7f:7e"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_fill_screen2(self):
        sim = """
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
................................................................................................................................
"""
        # TODO: Cozmo does "fd:7f:7e"
        expected = "f9:7f:7e"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_top_left(self):
        sim = """
1...............................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
"""
        expected = "81:3f:3e"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_top_left_5(self):
        sim = """
....1...........................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
"""
        expected = "03:81:3f:3a"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_top_left_1_8(self):
        sim = """
1.......1.......................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
"""
        expected = "81:06:81:3f:36"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_top_left_line(self):
        sim = """
11111111........................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
"""
        expected = "81:46:3f:37"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_top_line(self):
        sim = """
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
"""
        # TODO: Cozmo does "82:7f:7e". Why 82???
        expected = "81:7f:7e"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_bottom_line(self):
        sim = """
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
"""
        # TODO: Cozmo does "f8:82:7f:7e". Why 82???
        expected = "f8:81:7f:7e"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_left_line(self):
        sim = """
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
1...............................................................................................................................
"""
        # TODO: Cozmo does "fe:3f:3e". Why fe???
        expected = "fd:3f:3e"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_right_line(self):
        sim = """
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
...............................................................................................................................1
"""
        # TODO: Cozmo does "3f:3e:fe". Why fe???
        expected = "3f:3e:fd"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_columns(self):
        sim = """
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.
................................................................................................................................
"""
        # TODO: Cozmo does fd instead of f9. Why?
        expected = "f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:" \
                   "f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:" \
                   "f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:" \
                   "f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00:f9:00"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_rect(self):
        sim = """
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
1..............................................................................................................................1
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
"""
        # TODO: Cozmo does:
        # expected = "fe:82:f4:82:7f:7c:fe"
        expected = "fd:81:f4:81:7f:7c:fd"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_rect2(self):
        sim = """
.111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.1............................................................................................................................1.
.111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111.
"""
        # TODO: Cozmo does:
        # expected = "00:fe:82:f4:82:7f:7a:fe:00"
        expected = "00:fd:81:f4:81:7f:7a:fd:00"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_rect3(self):
        sim = """
................................................................................................................................
..1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1..........................................................................................................................1..
..1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111..
................................................................................................................................
"""
        # TODO: Cozmo does:
        # expected = "01:80:f6:80:80:82:ec:82:7f:78:80:f6:01"
        expected = "01:80:f5:80:81:ec:81:7f:78:80:f5:01"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_rect4(self):
        sim = """
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1.1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1..........................................................................................................................1.1
1.1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111.1
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
"""
        # TODO: Cozmo does
        # expected = "fe:82:f4:82:fe:86:ec:86:7f:78:fe:82:f4:82:fe"
        expected = "fd:81:f4:81:fd:85:ec:81:7f:78:fd:81:f4:81:fd"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_diagonal(self):
        sim = """
1111............................................................................................................................
....1111........................................................................................................................
........1111....................................................................................................................
............1111................................................................................................................
................1111............................................................................................................
....................1111........................................................................................................
........................1111....................................................................................................
............................1111................................................................................................
................................1111............................................................................................
....................................1111........................................................................................
........................................1111....................................................................................
............................................1111................................................................................
................................................1111............................................................................
....................................................1111........................................................................
........................................................1111....................................................................
............................................................1111................................................................
................................................................1111............................................................
....................................................................1111........................................................
........................................................................1111....................................................
............................................................................1111................................................
................................................................................1111............................................
....................................................................................1111........................................
........................................................................................1111....................................
............................................................................................1111................................
................................................................................................1111............................
....................................................................................................1111........................
........................................................................................................1111....................
............................................................................................................1111................
................................................................................................................1111............
....................................................................................................................1111........
........................................................................................................................1111....
............................................................................................................................1111
"""
        # TODO: Cozmo does
        # expected = "82:42:80:82:42:84:82:42:88:82:42:8c:82:42:90:82:42:94:82:42:98:82:42:9c:82:42:a0:82:42:a4:82:42:" \
        #            "a8:82:42:ac:82:42:b0:82:42:b4:82:42:b8:82:42:bc:82:42:c0:82:42:c4:82:42:c8:82:42:cc:82:42:d0:82:" \
        #            "42:d4:82:42:d8:82:42:dc:82:42:e0:82:42:e4:82:42:e8:82:42:ec:82:42:f0:82:42:f4:82:42:f8:82:42"
        expected = "81:42:80:81:42:84:81:42:88:81:42:8c:81:42:90:81:42:94:81:42:98:81:42:9c:81:42:a0:81:42:a4:81:42:" \
                   "a8:81:42:ac:81:42:b0:81:42:b4:81:42:b8:81:42:bc:81:42:c0:81:42:c4:81:42:c8:81:42:cc:81:42:d0:81:" \
                   "42:d4:81:42:d8:81:42:dc:81:42:e0:81:42:e4:81:42:e8:81:42:ec:81:42:f0:81:42:f4:81:42:f8:81:42"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_diagonal2(self):
        sim = """
............................................................................................................................1111
........................................................................................................................1111....
....................................................................................................................1111........
................................................................................................................1111............
............................................................................................................1111................
........................................................................................................1111....................
....................................................................................................1111........................
................................................................................................1111............................
............................................................................................1111................................
........................................................................................1111....................................
....................................................................................1111........................................
................................................................................1111............................................
............................................................................1111................................................
........................................................................1111....................................................
....................................................................1111........................................................
................................................................1111............................................................
............................................................1111................................................................
........................................................1111....................................................................
....................................................1111........................................................................
................................................1111............................................................................
............................................1111................................................................................
........................................1111....................................................................................
....................................1111........................................................................................
................................1111............................................................................................
............................1111................................................................................................
........................1111....................................................................................................
....................1111........................................................................................................
................1111............................................................................................................
............1111................................................................................................................
........1111....................................................................................................................
....1111........................................................................................................................
1111............................................................................................................................
"""
        # TODO: Cozmo does:
        # expected = "f8:82:42:f4:82:42:f0:82:42:ec:82:42:e8:82:42:e4:82:42:e0:82:42:dc:82:42:d8:82:42:d4:82:42:d0:82:" \
        #            "42:cc:82:42:c8:82:42:c4:82:42:c0:82:42:bc:82:42:b8:82:42:b4:82:42:b0:82:42:ac:82:42:a8:82:42:a4:" \
        #            "82:42:a0:82:42:9c:82:42:98:82:42:94:82:42:90:82:42:8c:82:42:88:82:42:84:82:42:80:82:42:82:42"
        expected = "f8:81:42:f4:81:42:f0:81:42:ec:81:42:e8:81:42:e4:81:42:e0:81:42:dc:81:42:d8:81:42:d4:81:42:d0:81:" \
                   "42:cc:81:42:c8:81:42:c4:81:42:c0:81:42:bc:81:42:b8:81:42:b4:81:42:b0:81:42:ac:81:42:a8:81:42:a4:" \
                   "81:42:a0:81:42:9c:81:42:98:81:42:94:81:42:90:81:42:8c:81:42:88:81:42:84:81:42:80:81:42:81:42"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        self.assertSameImage(sim, actual)

    def test_pycozmo(self):
        sim = """
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
.......111111111111......................11111111111............................................................................
.......11111111111111..................1111111111111............................................................................
.......1111.....11111111111....11111..111111.......1.....1111111111....11111111111...1111111111111111111......1111111111........
.......11111....11111..11111..11111...11111.............111111111111...11111111111...11111111111111111111....111111111111.......
.......1111111111111....1111..11111...1111.............11111....11111......111111....11111...11111...1111...11111....11111......
.......11111111111......1111111111....11111............1111......1111....111111......1111....1111....1111...1111......1111......
.......1111..............11111111......111111.....11...11111....11111...111111.......1111....1111....1111...11111....11111......
.......1111...............111111........111111111111....111111111111...11111111111...1111....1111....1111....111111111111.......
.......1111...............111111...........1111111.........111111......11111111111...1111....1111....1111.......111111..........
........................1111111.................................................................................................
........................111111..................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
................................................................................................................................
"""
        # TODO: Cozmo does:
        # expected = bytes([6, 168, 161, 66, 168, 133, 128, 137, 184, 168, 133, 132, 133, 66, 168, 149, 64, 168, 145, 188,
        #                   172, 141, 188, 172, 137, 192, 176, 129, 64, 176, 133, 192, 176, 141, 136, 133, 164, 176, 145,
        #                   132, 133, 164, 176, 161, 164, 180, 157, 164, 188, 149, 64, 180, 153, 168, 176, 153, 172, 176,
        #                   145, 180, 176, 141, 184, 176, 137, 188, 176, 129, 1, 176, 141, 184, 172, 149, 180, 172, 153,
        #                   176, 168, 157, 176, 168, 141, 128, 137, 176, 168, 137, 136, 137, 172, 168, 133, 140, 137, 172,
        #                   168, 133, 144, 133, 67, 168, 133, 140, 133, 176, 168, 137, 136, 133, 2, 184, 137, 180, 180,
        #                   145, 176, 176, 149, 64, 176, 137, 128, 137, 172, 176, 133, 136, 133, 66, 176, 137, 128, 137,
        #                   172, 176, 149, 64, 180, 145, 176, 184, 137, 1, 176, 133, 136, 133, 172, 176, 133, 132, 137,
        #                   172, 176, 133, 128, 141, 64, 176, 153, 65, 176, 141, 128, 133, 172, 176, 137, 132, 133, 64,
        #                   176, 133, 136, 133, 2, 176, 153, 66, 176, 137, 188, 176, 133, 65, 176, 153, 66, 176, 137, 188,
        #                   176, 133, 65, 176, 153, 65, 180, 149, 2, 184, 137, 180, 180, 145, 176, 176, 149, 64, 176, 137,
        #                   128, 137, 172, 176, 133, 136, 133, 66, 176, 137, 128, 137, 172, 176, 149, 64, 180, 145, 176,
        #                   184, 137, 5])
        expected = "06:a8:a1:42:a8:85:80:89:a8:85:84:85:42:a8:95:40:a8:91:ac:8d:ac:89:b0:81:40:b0:85:b0:8d:88:" \
                   "85:b0:91:84:85:b0:a1:b4:9d:bc:95:40:b4:99:b0:99:b0:91:b0:8d:b0:89:b0:81:01:b0:8d:ac:95:ac:" \
                   "99:a8:9d:a8:8d:80:89:a8:89:88:89:a8:85:8c:89:a8:85:90:85:43:a8:85:8c:85:a8:89:88:85:02:b8:" \
                   "89:b4:91:b0:95:40:b0:89:80:89:b0:85:88:85:42:b0:89:80:89:b0:95:40:b4:91:b8:89:01:b0:85:88:" \
                   "85:b0:85:84:89:b0:85:80:8d:40:b0:99:41:b0:8d:80:85:b0:89:84:85:40:b0:85:88:85:02:b0:99:42:" \
                   "b0:89:b0:85:41:b0:99:42:b0:89:b0:85:41:b0:99:41:b4:95:02:b8:89:b4:91:b0:95:40:b0:89:80:89:" \
                   "b0:85:88:85:42:b0:89:80:89:b0:95:40:b4:91:b8:89:05"
        actual = self._encode(sim)
        self.assertEqual(expected, actual)
        # self.assertSameImage(sim, actual)
